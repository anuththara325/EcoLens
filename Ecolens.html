<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EO-Climate Resilience Dashboard - Team EcoLense</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #0f172a 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .header p {
            color: #bfdbfe;
            font-size: 0.95rem;
        }

        .header-stats {
            text-align: right;
        }

        .header-stats .label {
            color: #bfdbfe;
            font-size: 0.875rem;
        }

        .header-stats .value {
            font-size: 1.75rem;
            font-weight: bold;
        }

        .status-overview {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .status-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-card.safe {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-card.alert {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .status-card.triggered {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .status-card .label {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-bottom: 4px;
        }

        .status-card .value {
            font-size: 2rem;
            font-weight: bold;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        #map {
            height: 500px;
            border-radius: 16px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .map-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .map-container h2 {
            margin-bottom: 16px;
            font-size: 1.5rem;
        }

        .regions-panel {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .region-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            border: 2px solid;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .region-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        .region-card.safe {
            border-color: #10b981;
        }

        .region-card.alert {
            border-color: #f59e0b;
        }

        .region-card.triggered {
            border-color: #ef4444;
        }

        .region-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .region-name {
            font-size: 1.25rem;
            font-weight: bold;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-badge.safe {
            background: #10b981;
        }

        .status-badge.alert {
            background: #f59e0b;
        }

        .status-badge.triggered {
            background: #ef4444;
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .metric {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 8px;
        }

        .metric-label {
            font-size: 0.75rem;
            color: #bfdbfe;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .metric-threshold {
            font-size: 0.875rem;
            color: #9ca3af;
        }

        .metric-status {
            font-size: 0.75rem;
            margin-top: 4px;
        }

        .metric-status.warning {
            color: #fbbf24;
        }

        .metric-status.danger {
            color: #f87171;
        }

        .trigger-alert {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
            border-radius: 12px;
            padding: 16px;
            margin-top: 12px;
        }

        .trigger-alert h4 {
            margin-bottom: 8px;
            font-size: 0.875rem;
        }

        .trigger-alert .amount {
            font-size: 1.25rem;
            font-weight: bold;
        }

        .detail-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .detail-panel h2 {
            margin-bottom: 16px;
            font-size: 1.75rem;
        }

        .detail-content {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
            border-radius: 12px;
            padding: 24px;
        }

        .detail-content h3 {
            font-size: 1.5rem;
            margin-bottom: 12px;
        }

        .detail-content p {
            color: #fecaca;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .detail-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .detail-stat {
            background: rgba(0, 0, 0, 0.3);
            padding: 16px;
            border-radius: 8px;
        }

        .detail-stat-label {
            font-size: 0.875rem;
            color: #d1d5db;
            margin-bottom: 4px;
        }

        .detail-stat-value {
            font-size: 1.75rem;
            font-weight: bold;
        }

        .prb-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .prb-box label {
            font-size: 0.875rem;
            color: #d1d5db;
            display: block;
            margin-bottom: 8px;
        }

        .prb-box .prb-name {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
        }

        .action-button {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
        }

        .action-button.success {
            background: #10b981;
        }

        .action-button.info {
            background: #3b82f6;
        }

        .footer {
            text-align: center;
            margin-top: 24px;
            color: #bfdbfe;
            font-size: 0.875rem;
        }

        .hidden {
            display: none;
        }

        .leaflet-popup-content {
            color: #1f2937;
        }

        .leaflet-popup-content h3 {
            margin-bottom: 8px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                text-align: center;
                gap: 16px;
            }
            
            .header-stats {
                text-align: center;
            }
            
            .status-overview {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div>
                <h1>EO-Climate Resilience Dashboard</h1>
                <p>Real-time Climate Resilience Tipping Point Monitoring</p>
            </div>
            <div class="header-stats">
                <div class="label">Powered by Copernicus</div>
                <div class="value">3 Regions</div>
            </div>
        </div>

        <!-- Status Overview -->
        <div class="status-overview">
            <div class="status-card safe">
                <div>
                    <div class="label">Safe</div>
                    <div class="value">1</div>
                </div>
                <div style="font-size: 2rem;">‚úì</div>
            </div>
            <div class="status-card alert">
                <div>
                    <div class="label">Alert</div>
                    <div class="value">1</div>
                </div>
                <div style="font-size: 2rem;">‚ö†</div>
            </div>
            <div class="status-card triggered">
                <div>
                    <div class="label">Triggered</div>
                    <div class="value">1</div>
                </div>
                <div style="font-size: 2rem;">üö®</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Map -->
            <div class="map-container">
                <h2>üìç Regional Overview Map</h2>
                <div id="map"></div>
            </div>

            <!-- Regions Panel -->
            <div class="regions-panel">
                <div class="region-card safe" onclick="selectRegion(0)">
                    <div class="region-header">
                        <div class="region-name">Central Luzon</div>
                        <div class="status-badge safe">Safe</div>
                    </div>
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-label">üåø NDVI</div>
                            <div class="metric-value">0.68</div>
                            <div class="metric-threshold">Threshold: 0.55</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">üå°Ô∏è LST</div>
                            <div class="metric-value">32.4¬∞C</div>
                            <div class="metric-threshold">Threshold: 38.5¬∞C</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">üíß Mangrove</div>
                            <div class="metric-value">98.5%</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">üìè Subsidence</div>
                            <div class="metric-value">2.1mm/yr</div>
                        </div>
                    </div>
                </div>

                <div class="region-card alert" onclick="selectRegion(1)">
                    <div class="region-header">
                        <div class="region-name">Eastern Visayas</div>
                        <div class="status-badge alert">Alert</div>
                    </div>
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-label">üåø NDVI</div>
                            <div class="metric-value">0.52</div>
                            <div class="metric-threshold">Threshold: 0.55</div>
                            <div class="metric-status warning">‚ö† Below threshold</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">üå°Ô∏è LST</div>
                            <div class="metric-value">37.8¬∞C</div>
                            <div class="metric-threshold">Threshold: 38.5¬∞C</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">üíß Mangrove</div>
                            <div class="metric-value">96.2%</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">üìè Subsidence</div>
                            <div class="metric-value">4.2mm/yr</div>
                        </div>
                    </div>
                </div>

                <div class="region-card triggered" onclick="selectRegion(2)">
                    <div class="region-header">
                        <div class="region-name">Mindanao</div>
                        <div class="status-badge triggered">Triggered</div>
                    </div>
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-label">üåø NDVI</div>
                            <div class="metric-value">0.48</div>
                            <div class="metric-threshold">Threshold: 0.55</div>
                            <div class="metric-status danger">üö® Critical</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">üå°Ô∏è LST</div>
                            <div class="metric-value">39.2¬∞C</div>
                            <div class="metric-threshold">Threshold: 38.5¬∞C</div>
                            <div class="metric-status danger">üö® Extreme</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">üíß Mangrove</div>
                            <div class="metric-value">98.1%</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">üìè Subsidence</div>
                            <div class="metric-value">3.5mm/yr</div>
                        </div>
                    </div>
                    <div class="trigger-alert">
                        <h4>üö® DISBURSEMENT ACTIVE</h4>
                        <div class="amount">‚Ç±2.4M</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detail Panel -->
        <div class="detail-panel" id="detailPanel">
            <h2 id="detailTitle">Select a region to view details</h2>
            <div id="detailContent"></div>
        </div>

        <!-- Footer -->
        <div class="footer">
            Powered by Copernicus Sentinel-1, Sentinel-2 & Climate Change Services | Team EcoLense
        </div>
    </div>

    <!-- Load Leaflet BEFORE our script -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    
    <script>
        // Wait for page to fully load
        window.addEventListener('load', function() {
            const regions = [
                {
                    name: "Central Luzon",
                    status: "safe",
                    lat: 15.4817,
                    lng: 120.7122,
                    ndvi: 0.68,
                    ndviThreshold: 0.55,
                    lst: 32.4,
                    lstThreshold: 38.5,
                    mangrove: 98.5,
                    subsidence: 2.1,
                    color: "#10b981",
                    description: "All climate resilience indicators within safe thresholds. Continuous monitoring active."
                },
                {
                    name: "Eastern Visayas",
                    status: "alert",
                    lat: 11.2444,
                    lng: 125.0044,
                    ndvi: 0.52,
                    ndviThreshold: 0.55,
                    lst: 37.8,
                    lstThreshold: 38.5,
                    mangrove: 96.2,
                    subsidence: 4.2,
                    color: "#f59e0b",
                    description: "NDVI below threshold for 2 consecutive periods. Monitoring closely for potential trigger.",
                    alertMessage: "Next check: 1 bi-weekly period (14 days). Action if threshold persists: Automatic trigger and disbursement."
                },
                {
                    name: "Mindanao",
                    status: "triggered",
                    lat: 7.1907,
                    lng: 125.4553,
                    ndvi: 0.48,
                    ndviThreshold: 0.55,
                    lst: 39.2,
                    lstThreshold: 38.5,
                    mangrove: 98.1,
                    subsidence: 3.5,
                    color: "#ef4444",
                    triggerType: "Agricultural Tipping Point",
                    triggerDetails: "NDVI below 10-year average for 3 consecutive bi-weekly periods",
                    disbursementAmount: "‚Ç±2.4M",
                    prb: "Agri-PRB #23: Drought-resistant seeds distribution",
                    beneficiaries: "1,200 smallholder farmers"
                }
            ];

            // Initialize map
            const map = L.map('map').setView([12.8797, 121.7740], 6);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);

            // Add region markers
            regions.forEach((region, index) => {
                const marker = L.circleMarker([region.lat, region.lng], {
                    radius: 15,
                    fillColor: region.color,
                    color: '#fff',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(map);

                marker.bindPopup(`
                    <div style="min-width: 200px;">
                        <h3 style="margin-bottom: 8px; color: #1f2937;">${region.name}</h3>
                        <p style="margin-bottom: 4px;"><strong>Status:</strong> ${region.status.toUpperCase()}</p>
                        <p style="margin-bottom: 4px;"><strong>NDVI:</strong> ${region.ndvi}</p>
                        <p style="margin-bottom: 4px;"><strong>LST:</strong> ${region.lst}¬∞C</p>
                        <p style="margin-bottom: 12px;"><strong>Mangrove:</strong> ${region.mangrove}%</p>
                        <button onclick="selectRegion(${index})" style="padding: 8px 16px; background: ${region.color}; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; width: 100%;">View Details</button>
                    </div>
                `);

                marker.on('click', () => selectRegion(index));
            });

            // Make selectRegion global
            window.selectRegion = function(index) {
                const region = regions[index];
                const detailTitle = document.getElementById('detailTitle');
                const detailContent = document.getElementById('detailContent');

                detailTitle.textContent = `${region.name} - Detailed Status`;

                if (region.status === 'triggered') {
                    detailContent.innerHTML = `
                        <div class="detail-content">
                            <h3>üö® ${region.triggerType} TRIGGERED</h3>
                            <p>${region.triggerDetails}</p>
                            
                            <div class="detail-stats">
                                <div class="detail-stat">
                                    <div class="detail-stat-label">Disbursement Amount</div>
                                    <div class="detail-stat-value">${region.disbursementAmount}</div>
                                </div>
                                <div class="detail-stat">
                                    <div class="detail-stat-label">Beneficiaries</div>
                                    <div class="detail-stat-value">${region.beneficiaries}</div>
                                </div>
                            </div>

                            <div class="prb-box">
                                <label>Active Pre-Approved Resilience Blueprint:</label>
                                <div class="prb-name">${region.prb}</div>
                            </div>

                            <div class="action-buttons">
                                <div class="action-button success">‚úì Funds Disbursed</div>
                                <div class="action-button info">Implementation In Progress</div>
                            </div>
                        </div>
                    `;
                } else if (region.status === 'alert') {
                    detailContent.innerHTML = `
                        <div class="detail-content" style="background: rgba(245, 158, 11, 0.2); border-color: #f59e0b;">
                            <h3>‚ö† Monitoring Alert</h3>
                            <p style="color: #fcd34d;">${region.description}</p>
                            <p style="color: #d1d5db; font-size: 0.875rem; margin-top: 16px;">
                                ${region.alertMessage}
                            </p>
                        </div>
                    `;
                } else {
                    detailContent.innerHTML = `
                        <div class="detail-content" style="background: rgba(16, 185, 129, 0.2); border-color: #10b981;">
                            <h3>‚úì Status: Normal</h3>
                            <p style="color: #6ee7b7;">${region.description}</p>
                        </div>
                    `;
                }

                // Scroll to detail panel
                document.getElementById('detailPanel').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            };

            // Select Mindanao by default to show triggered state
            selectRegion(2);
        });
    </script>
</body>
</html>